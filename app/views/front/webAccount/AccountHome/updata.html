<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
		<title>上传信息-X职查</title>
		<meta name="keywords" content="">
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="shortcut icon" type="image/png" href="@{'/public/images/favicon.ico'}" />
		<link rel="stylesheet" type="text/css" href="@{'/public/stylesheets/layui/css/layui.css'}" />
		<link href="@{'/public/stylesheets/webcss/public.css'}" rel="stylesheet" type="text/css" />
		<link href="@{'/public/stylesheets/webcss/style.css'}" rel="stylesheet" type="text/css" />
		<script type="text/javascript" src="/public/javascripts/js/jquery.1.9.1.js"></script>
		<script type="text/javascript" src="@{'/public/javascripts/common.js'}"></script>
	    <script type="text/javascript" src="@{'/public/javascripts/ajaxfileupload.js'}"></script>
	    <script type="text/javascript" src="@{'/public/javascripts/index.js'}"></script>
	    <script type="text/javascript" src="@{'/public/javascripts/jquery.json-2.4.min.js'}"></script>
		<style type="text/css">
		 .select_on{
		     display: block;
		     width: 100%;
    padding-left: 10px;
    padding-right: 30px;
    cursor: pointer;
    border-width: 1px;
    border-style: solid;
    background-color: #fff;
    border-radius: 2px;
    border-color: #e6e6e6;
    height: 38px;
    line-height: 1.3;
		 }
		</style>
	</head>

	<body class="bgf">
	#{include "common/webHeader.html"/}
		<div class="about_content">
			<div class="fl">
				<div class="page_menu">
					<ul>
						<li>
							<a href="@{front.webHome.HomeAction.home()}">首页</a>
						</li>
						<li>/</li>
						<li>
							<a href="@{front.webAccount.AccountHome.home()}">用户中心</a>
						</li>
						<li>/</li>
						<li>
							<a >上传信息</a>
						</li>
					</ul>
				</div>
				<!-- 左边导航区域 -->
	#{include "front/webAccount/AccountHome/homeLeft.control"/}
			</div>
			<div class="fr" id="updata">
				<form class="layui-form" action="">
					<div class="data_lable">
						<div class="data_lables">
							<p class="fl_names">姓名</p>
							<div class="fr_input_type">
								<input type="text" name="name" id="name" value="" />
								<img src="/public/images/webimg/updata_08.jpg" />
							</div>
							<img src="/public/images/webimg/updata_11.jpg" class="starx" />
						</div>
						<div class="data_lables">
							<p class="fl_names">身份证号</p>
							<div class="fr_input_type">
								<input type="text" name="id_number" id="id_number" value=""  />
								<img src="/public/images/webimg/updata_08.jpg" />
							</div>
							<img src="/public/images/webimg/updata_11.jpg" class="starx" />
						</div>
						<!--<div class="data_lables">
							<p class="fl_names">信息类型</p>
							<div class="fr_input_type1">
								<div class="select_box">
								      <select name="type_id" id="type_id" lay-verify="required" class="select_on" style="display:block;"> 
								        <option value="0">请选择</option>
								        <option value="1">负面事件</option>
								        <option value="2">正面事件</option>
								      </select>
								</div>
								<div class="select_box">
									<select name="type_name"  id="type_name"lay-verify="required" class="select_on" style="display:block;">
								        <option value="0">请选择</option>
								      </select>
								</div>
							</div>
							<img src="/public/images/webimg/updata_11.jpg" />
						</div> -->
					 	<div class="data_lables">
							<p class="fl_names">信息类型</p>
							<div class="fr_input_type1">
								<div class="select_box selegos">
									<p class="htmlw">请选择</p>
										<div class="sele_covers">
											<div class="sele_cov_select">
												<ul id="type_id"> 
												    <li name="type_id" value="0" class="on">请选择</li>
													<li name="type_id" value="1">负面事件</li>
													<li name="type_id" value="2">正面事件</li>
												</ul>
											</div>
										</div>
								</div>
								<div class="select_box selegos">
									<p class="htmlw" id="typeName">请选择</p>
										<div class="sele_covers">
											<div class="sele_cov_select">
												<ul id="type_name">
													 <li name="type_name" value="0" >请选择</li>
												</ul>
											</div>
										</div>
								</div>
							</div>
							<img src="/public/images/webimg/updata_11.jpg" class="starx" />
						</div>
						<div class="data_lables">
							<p class="fl_names">事件描述</p>
							<div class="fr_input_type2">
								<textarea placeholder="请如实描述事件经过" id="event_description"></textarea>
							</div>
							<img src="/public/images/webimg/updata_11.jpg" class="starx" />
						</div>
						<div class="data_lables">
							<p class="fl_names">时间发生时间</p>
							<div class="fr_input_type1">
								<div class="select_box">
									 <input type="text" placeholder="事件发生年份" class="layui-input" id="test1">
									 <img src="/public/images/webimg/updata_31.jpg"/>
								</div>
								<div class="select_box">
									<input type="text" placeholder="月份" class="layui-input" id="test2" >
									 <img src="/public/images/webimg/updata_31.jpg"/>
								</div>
							</div>
							<img src="/public/images/webimg/updata_11.jpg" class="starx" />
							<p class="last_infos">信息的有效期为5年，<br />超过5年的信息将不能被检索到。</p>
						</div>
						<div class="data_lables">
							<p class="fl_names">信息状态</p>
							<div class="fr_input_type1">
								<div class="select_box1" style="width: 110px;">
									<select name="status" id="status" lay-verify="required"class="select_on" style="display:block;">
								        <option value="0">请选择</option>
								        <option value="1">有效</option>
								        <option value="2">下线</option>
								      </select>
								</div>
							</div>
							<img src="/public/images/webimg/updata_11.jpg" class="starx" />
							<p class="last_infos">信息的有效期为5年，<br />超过5年的信息将不能被检索到。</p>
						</div>
						<div class="data_lables" id="data_add">
							<p class="fl_names">上传证明材料</p>
							<div class="add" id="addImage" onclick="openlast();">
								<img src="/public/images/webimg/updata_38.jpg" />
								<p>上传文件</p>
							</div>
							<p class="last_infos" id="last_info">1、确保姓名信息区域拍摄清晰。<br /> 2、材料仅用于存证，不对任何人展示。
								<br /> 3、仅支持jpg、png、gif 格式，上传文件需<br /> 小于2MB。
							</p>
						</div>
						<div class="btn_submitts" id="submit" style="cursor: pointer;">提交</div>
						<div class="data_lables">
							<p class="fl_names">规则声明</p>
							<div class="font_textares">
								<p>1，作为信息的实名上传者，您需要对信息的真实性负责，请确保信息真实客观的前提下谨慎填写。</p>
								<p>2，如被上传个人对此信息有异议，可能会发起申诉，申诉后经过双方协商您有权修改信息的有效或下线。</p>
								<p>3，如果双方不能达成协议，且相关方认为信息为不实信息，可能会引起法律纠纷。当申诉者有胜诉文书 证明，平台将介入删除相关信息。
								</p>
								<p>3，如果双方不能达成协议，且相关方认为信息为不实信息，可能会引起法律纠纷。当申诉者有胜诉文书 证明，平台将介入删除相关信息。
								</p>
								<p>5，发布人违反规则发布虚假信息，会进入本平台使用者黑名单。</p>
								<p>6，创建信用社会，从自我做起，请尊守规则，尊重事实！</p>
							</div>
						</div>
					</div>
			</form>
		</div>
		<div class="fr" id="state" style="display:none;">
				<div class="teaxs">
					<p id="error">信息上传成功<br /> 需要1个工作日进行审核！</p>
					<img src="/public/images/webimg/center_16.jpg" />
					<div class="box_btn_links">
						<a href="@{front.webAccount.AccountHome.myUpdata()}" class="fl_pobtn">去我的上传</a>
						<a href="@{front.webAccount.AccountHome.home()}" class="fr_pobtn">去我的账户</a>
					</div>
				</div>
			</div>
		</div>
		
	#{include "common/webBottom.html"/}
		<div class="fade_po " id="mesType" style="display: none">
			<div class="fade_boxss">
				<h2>选择一种材料类型开始上传</h2>
				<ul>
					<li name="imgType" value="1" mark="smallImagId_card" >身份证明<img src="/public/images/webimg/updata_11.jpg"></li>
					<li name="imgType" value="2" mark="smallImagLabor">劳动合同<img src="/public/images/webimg/updata_11.jpg"></li>
					#{list images_type}
					<li name="imgType" value="${_?.id}" mark="materials">${_?.name}</li>
					#{/list}
				</ul>
				<div class="btn_grows">
					<a href="#" class="fl"> 
					<input  style="width: 9.10rem;line-height: 2.5rem;opacity: 0;position: absolute;margin-left: -12%;cursor: pointer;" 
		             type="file"  name="imgFile" id="imgFile" onchange="uploadImage(this);" />上传</a>
					<a href="#" class="fr">取消</a>
				</div>
			</div>
		</div>
		
		<div class="fade_po land_files" style="display: none" id="proError">
			<div class="land_filess">
				<p id="errorMsg"></p>
				<div class="btn_ground">
					<a href="#" class="closss" id="proErrorCancel" style="margin-left:82px">取消</a>
				</div>
			</div>
		</div>
		<div class="fade_po land_files" style="display: none" id="realNameError">
			<div class="land_filess">
				<p>完成企业实名认证，即可上传信息！</p>
				<div class="btn_ground">
					<a href="@{front.webAccount.AccountHome.webRealName()}" class="closs" >去实名</a>
					<a href="@{front.webAccount.AccountHome.home()}" class="closss" >进入个人中心</a>
				</div>
			</div>
		</div>
		<!--[if !IE]><!-->
		<!-- <script src="@{'/public/javascripts/webjs/jquery-2.1.1.min.js'}" type="text/javascript"></script> -->
			<script type="text/javascript" src="@{'/public/javascripts/webjs/js.js'}"></script>
		<script type="text/javascript" src="@{'/public/stylesheets/layui/layui.js'}"></script>
			<script>

layui.use('laydate', function(){
  var laydate = layui.laydate;
  laydate.render({
    elem: '#test1' ,//指定元素
    type: "year"
  });
  laydate.render({
    elem: '#test2' ,//指定元素
     type: "month",
     format: 'MM'
  });
});
$("#test2").click(function(){
    $(".layui-laydate-header").css("display","none");
})

$('.fade_po .fade_boxss .btn_grows .fr').click(function(){
	$('.fade_po').hide()
})
$('.fade_boxss ul li').click(function(){
	$(this).addClass('on').siblings().removeClass('on')
})
</script>
<script type="text/javascript">
function openlast(){
	$("#mesType").css("display","block");
} 
$(function(){
		       $("#li_2").addClass("on");
		       $("#li_2").prevAll().removeClass("on");
		       $("#li_2").nextAll().removeClass("on");
		       $("#img_2").attr("src","/public/images/webimg/updata_2.jpg");
		       if(${users.authentication_status}!=2){
		       	$("#realNameError").css("display","block");
		       }
		 })
		  /* $("#type_id").change(function(){
		  $("#type_name").html("");
		  	getTypeName($(this).val());  		
           }); */
            $("li[name='type_id']").each(function(){
					$(this).click(function(){
					getTypeName($(this).val());
					})
			});
             function getTypeName(id){
			  if(id==""){
			  var html="<li name='type_name' value='0'>请选择</li>";
			  $("#type_name").append(html);
			  }
			  $.ajax({
			  url:"@{front.webAccount.AccountHome.getTypeName()}",
			  type:"POST",
			  data:{
			  typeId:id
			  },
			  success:function(data){
			  var html="";
			  html="<li name='type_name' value='0' class='on'>请选择</li>";
			  for(var i in data){
			  html+="<li name='type_name' value="+data[i].id+">"+data[i].name+"</li>";
			  }
			  $("#type_name").html(""); 
			 	$("#type_name").append(html); 
			 	$("li[name='type_name']").each(function(){
					$(this).click(function(){
					   $(this).addClass("on").siblings().removeClass('on');
					   $("#typeName").html($(this).html());
					})
			});
			  }
			  });
		 };
		  $("#typeName").click(function(){
		   var val;
		      $("li[name='type_id']").each(function(){
					if($(this).attr("class")=="on"){
					val=$(this).val();
					}
			});
		   		if(val==0){
		   		  alert("请选择发生事件类型");
		   		  return false;
		   		}
           }); 
   $("li[name='imgType']").each(function(){
		$(this).click(function(){
		    $("#imgFile").attr("mark",$(this).attr("mark"));
		    $("#imgFile").attr("mark1",$(this).val());
		})
});
          
            var i=0;
 /**
 * 上传图片
 * @param fileElementId
 * @param imageElementId
 */
function uploadImage(element) {
    var fileElementId=element.id;
   var imageElementId=$(element).attr("mark");
    var mark1=$(element).attr("mark1");
   if(imageElementId==""||imageElementId==null){
   	$("#errorMsg").html("请选择上传的图片类型");
   	$("#proError").css("display","block");
		return;
   }
	var path = $("#" + fileElementId).val();
	if(path == "") {
		$("#errorMsg").html("请选择上传的图片");
   		$("#proError").css("display","block");
		return;
	}
	 $.ajaxFileUpload({
		url :  http_path +"/FileUpload/uploadImage",
		secureuri : false,
		fileElementId : fileElementId,
		dataType : "text",
		success : function(data) {
			data = $.evalJSON(data);
			if (data.code < 0) {
				$("#errorMsg").html(data.msg);
   				$("#proError").css("display","block");
				return;
			}
			i+=1;
			$("#addImage").remove();
            $("#last_info").remove();
			var html="<div class='add_yulan'  id='add_yulan'><img  src='' mark="+mark1+" name='"+imageElementId+"' id='"+imageElementId+i+"' style='display:none;width: 100%;height: 100%;margin: auto;right: auto;top: auto;'/><p>预览</p><img src='/public/images/webimg/xxx_03.jpg' /></div> "
		     html+="<div class='add' id='addImage' onclick='openlast();'><img src='/public/images/webimg/updata_38.jpg' /><p>上传文件</p></div>";
		     html+="<p class='last_infos' id='last_info'>1、确保姓名信息区域拍摄清晰。<br /> 2、材料仅用于存证，不对任何人展示。<br /> 3、仅支持jpg、png、gif 格式，上传文件需<br /> 小于2MB。	</p>";		
			$("#data_add").html($("#data_add").html()+html);
			$("#" + imageElementId+i).attr("src", data.filename);
			$("#" + imageElementId+i).css("display","block");
			$('.fade_po').hide()
		},
		error : function(data, status, e) {
			$("#errorMsg").html("上传图片失败");
   			$("#proError").css("display","block");
		}
	}) 
}
         $("#submit").click(function(){
             var name=$("#name").val();
             var id_number=$("#id_number").val();
             var type_id="";
              $("li[name='type_name']").each(function(){
					if($(this).attr("class")=="on"){
					type_id=$(this).val();
					}
			});
             var event_description=$("#event_description").val();
             var date_year=$("#test1").val();
             var date_month=$("#test2").val();
             var status=$("#status").val();
             var  cardsrc="";
             var  cardMark="";
		$("img[name='smallImagId_card']").each(function(){
			cardsrc=cardsrc+$(this).attr("src")+",";
			cardMark=cardMark+$(this).attr("mark")+",";
		});
		//cardsrc=cardsrc.substring(0,cardsrc.length-1);
		var laborsrc="";
		var  laborMark="";
		$("img[name='smallImagLabor']").each(function(){
			laborsrc=laborsrc+$(this).attr("src")+",";
			laborMark=laborMark+$(this).attr("mark")+",";
		});
		//laborsrc=laborsrc.substring(0,laborsrc.length-1);
		var matesrc="";
		var mateMark="";
		$("img[name='materials']").each(function(){
			matesrc=matesrc+$(this).attr("src")+",";
			mateMark=mateMark+$(this).attr("mark")+",";
		});
		matesrc=cardsrc+laborsrc+matesrc;
		mateMark=cardMark+laborMark+mateMark;
		matesrc=matesrc.substring(0,matesrc.length-1);
		mateMark=mateMark.substring(0,mateMark.length-1);
		if(name==""){
		   	$("#errorMsg").html("请输入姓名");
   			$("#proError").css("display","block");
		   	return false;
		}
		if(id_number==""){
		   	$("#errorMsg").html("请输入身份证号");
   			$("#proError").css("display","block");
		   	return false;
		}
		var idcardReg = /^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/;
		if(!idcardReg.test(id_number)){
		   	$("#errorMsg").html("身份证格式有误");
   			$("#proError").css("display","block");
		   	return false;
		}
		if(type_id==0){
		   	$("#errorMsg").html("请选择信息类型");
   			$("#proError").css("display","block");
		   	return false;
		}
		if(event_description==""){
		   	$("#errorMsg").html("请如实描述事件经过");
   			$("#proError").css("display","block");
		   	return false;
		}
		if(date_year==""){
		   	$("#errorMsg").html("请选择事件发生年份");
   			$("#proError").css("display","block");
		   	return false;
		}
		if(date_month==""){
			$("#errorMsg").html("请选择事件发生月份");
   			$("#proError").css("display","block");
		   	return false;
		}
		if(status==0){
			$("#errorMsg").html("请选择信息状态");
   			$("#proError").css("display","block");
		   	return false;
		}
		if(cardsrc==""){
		    $("#errorMsg").html("请上传身份证明");
   			$("#proError").css("display","block");
		   	return false;
		}
		if(laborsrc==""){
		    $("#errorMsg").html("请上传劳动合同");
   			$("#proError").css("display","block");
		   	return false;
		}
		var time=date_year+date_month;
		 $.ajax({
			url:"@{front.webAccount.AccountHome.updataNegativeInfor()}",
			type:"POST",
			data:{
				name:name,
				id_number:id_number,
				type_id:type_id,
				event_description:event_description,
				time:time,
				status:status,
				matesrc:matesrc,
				mateMark:mateMark
			},
			success:function(data){
				if(data.code!=0){
					$("#error").text("失败,系统好像开了点小差");
					$("#updata").css("display","none");
					$("#state").css("display","block");
				}else{
					$("#updata").css("display","none");
					$("#state").css("display","block");
				}
			}
		}); 
             
        }) 
        
        $("#proErrorCancel").click(function(){
        	$("#proError").css("display","none");
        });
		</script>
	</body>

</html>