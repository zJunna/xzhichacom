<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
		<title>安全设置-X职查</title>
		<meta name="keywords" content="">
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="shortcut icon" type="image/png" href="@{'/public/images/favicon.ico'}" />
		<link rel="stylesheet" type="text/css" href="@{'/public/stylesheets/layui/css/layui.css'}" />
		<link href="@{'/public/stylesheets/webcss/public.css'}" rel="stylesheet" type="text/css" />
		<link href="@{'/public/stylesheets/webcss/style.css'}" rel="stylesheet" type="text/css" />
		<script type="text/javascript" src="/public/javascripts/js/jquery.1.9.1.js"></script>
	</head>

	<body class="bgf">
		#{include "common/webHeader.html"/}
		<div class="about_content">
			<div class="fl">
				<div class="page_menu">
					<ul>
						<li>
							<a href="#">首页</a>
						</li>
						<li>/</li>
						<li>
							<a href="#">用户中心</a>
						</li>
						<li>/</li>
						<li>
							<a href="#">安全设置</a>
						</li>
					</ul>
				</div>
					<!-- 左边导航区域 -->
	#{include "front/webAccount/AccountHome/homeLeft.control"/}
			</div>
			<div class="fr" style="min-height: auto;padding-bottom: 30px;">
				<div class="emilas">
					<h6>安全邮箱修改</h6>
					<div class="cont_em">
						<p class="aqen">安全邮箱</p>
						<div class="cont_title">
							<div class="lllg">
							#{if users?.email==null}
							<input type="text" readonly="readonly" name="" id="noSet" value="当前未设置安全邮箱" />
							#{/if}
							#{else}<input type="text" readonly="readonly" class="on1" name="" id="noSet" value="${users?.email}" /><span>已验证</span>#{/else}
							</div>
							<div class="lllg" id="code" style="display:none;">
							<input type="text" placeholder="请输入新验证码" class="on1"  id="yanzhengma"  name="yanzhengma"value="" />
				            <a  class="hqs" id="codeTimes"  onclick="sendCode();">获取验证码</a>
				            </div>
							<p class="www hide" id="noSave">未激活，您需要点击下方“激活该邮箱”发送激活邮件，并前往邮箱进行激活操作</p>
							<div class="cont_btn_grow">
							     #{if users?.email==null}<div id="setEmail">设置安全邮箱</div>
							     #{/if}#{else}
								<div id="updataEmail">修改安全邮箱</div>#{/else}
								<div id="saveEmail" style="display:none;">激活邮箱</div>
							</div>
						</div>
					</div>
				</div>
				<div class="emilas">
					<h6>安全手机号修改</h6>
					<div class="cont_em">
						<p class="aqen">安全手机号</p>
						<div class="cont_title">
							<div class="lllg">
							<input type="text" readonly="readonly" name="" class="on1" id="mobile" value="${users?.mobile}" />
							<span id="mobileStatus">已验证</span>
							</div>
							<div class="lllg" id="code1" style="display:none;">
							<input type="text" placeholder="请输入新验证码" class="on1"  id="yanzhengma1"  name="yanzhengma1"value="" />
				            <a  class="hqs" id="codeTimes1"  onclick="sendCode1();">获取验证码</a>
				            </div>
							<div class="cont_btn_grow">
								<div id="setMobile">修改手机号</div>
							</div>
						</div>
					</div>
				</div>
				<form action="@{front.webAccount.AccountHome.saveWebPassword()}" method="post" id="form">
				<div class="land_password">
					<h6>修改登录密码</h6>
					<div class="land_lable">
						<p>原密码</p>
						<input type="password" placeholder="密码" name="originalPassword" class="a_i" id="originalPassword" value="" />
					</div>
					<div class="land_lable">
						<p>手机验证码</p>
						<input type="text" placeholder="请输入验证码" name="mobileCode" class="b_i" id="mobileCode" value="" />
						<div id="codeTimess"  onclick="sendCodes();">获取</div>
					</div>
					<div class="land_lable">
						<p>新密码</p>
						<input type="password" placeholder="6-16位字母和数字组成的密码" name="password" class="a_i" id="password" value="" />
					</div>
					<div class="land_lable">
						<p>确认新密码</p>
						<input type="password" placeholder="6-16位字母和数字组成的密码" name="confirmPassword" class="a_i" id="confirmPassword" value="" />
					</div>
					<p class="kants" id="error" style="display:none;">原密码不正确</p>
					<div class="btns_gg">
						<div id="submitPassword">确认修改</div>
						<p id="loginPass">忘记登录密码</p>
					</div>
				</div>
				</form>
			</div>
				</div>
				<div class="fade_po asx" style="display: none" id="noXError">
						<div class="fade_po_nbox">
							<h2 id="setH2"></h2>
							<div class="btn_ground">
								<a href="#" class="closs" id="sure">确定</a>
								<a href="#" class="closss" id="buyVipCancel">取消</a>
							</div>
							<div class="readys_item">
							</div>
						</div>
				</div>
			#{include "common/webBottom.html"/}
			<!--[if !IE]><!-->
			<script src="@{'/public/javascripts/webjs/jquery-2.1.1.min.js'}" type="text/javascript"></script>
			<script type="text/javascript" src="@{'/public/javascripts/webjs/js.js'}" ></script>
			<script type="text/javascript" src="@{'/public/stylesheets/layui/layui.js'}"></script>
			<script>
				$('.land_password').find('input').focus(function(){
					$(this).addClass('on')
				})
				$('.land_password').find('input').blur(function(){
					$(this).removeClass('on')
				})
			</script>
			<script type="text/javascript">
			$(function(){
		       $("#li_10").addClass("on");
		       $("#li_10").prevAll().removeClass("on");
		       $("#li_10").nextAll().removeClass("on");
		      $("#img_10").attr("src","/public/images/webimg/left_centeres.jpg");
		 })
			var remain = 60;
		
		function countDown() {
		  if (remain == 0) {
		    remain = 60;
		    $("#codeTimes").html("点击发送");
		    $("#codeTimes").attr("onclick", "sendCode();");
		    return;
		  }
		  $("#codeTimes").html("" + remain-- + "秒后重发");
		  setTimeout("countDown()",1000);
		}
			function sendCode(){
			var email = $("#noSet").val();
		     var verifyEmail = #{jsAction @webVerifyEmail(':email')/}
			$.post(verifyEmail({email:email}),function(data){
			    if(data.error.code < 0){
			           $("#noXError").css("display","block");
			           $("#setH2").html(data.error.msg);
			    }else{
					countDown();
					$("#codeTimes").attr("onclick", "void(0);");
				}
			},'json');
	 }
			$("#setEmail").click(function(){
			      $("#noSet").removeAttr("readonly");
			      $("#noSet").addClass("on1");
			      $("#noSet").val("");
			      $("#noSet").attr("placeholder","请输入邮箱");
			      $("#code").css("display","block");
			      $("#setEmail").css("display","none");
			      $("#saveEmail").css("display","block");
			})
			 $("#saveEmail").click(function(){
			        var email=$("#noSet").val();
			        if(email==""){
			           $("#noXError").css("display","block");
			           $("#setH2").html("请输入邮箱");
			           return false;
			        }
			         if($("#yanzhengma").val() == ''){
			          $("#noXError").css("display","block");
			           $("#setH2").html("请输入验证码");
						return false;
					 } 
			        /* 
					验证验证码
					*/
					var verifyEmailCode = #{jsAction @webVerifyEmailCode(':email',':smsCode')/}
				  		$.post(verifyEmailCode({email:email,smsCode:$("#yanzhengma").val()}),function(data){
						   if(data.code<0){
						    $("#noXError").css("display","block");
					    	  $("#setH2").html(data.msg);
						   }else{
						   $("#errorInfo").html("");
						         $.ajax({
							  url:"@{front.webAccount.AccountHome.saveWebEmails()}",
							  type:"POST",
							  data:{
							  email:email
							  },
							  success:function(data){
							      if(data.code<0){
							       $("#noXError").css("display","block");
					    	       $("#setH2").html(data.msg);
							      }else{
							       location.reload();
							      }
							  }
							 });
				        }
			  		});
			 
			 })
			 $("#updataEmail").click(function(){
			     $("#noSet").removeAttr("readonly");
			     $("#code").css("display","block");
			      var email=$("#noSet").val();
			        if(email==""){
			           $("#noXError").css("display","block");
			           $("#setH2").html("请输入邮箱");
			           return false;
			        }
			         if($("#yanzhengma").val() == ''){
			          $("#noXError").css("display","block");
			           $("#setH2").html("请输入验证码");
						return false;
					 } 
			        /* 
					验证验证码
					*/
					var verifyEmailCode = #{jsAction @webVerifyEmailCode(':email',':smsCode')/}
				  		$.post(verifyEmailCode({email:email,smsCode:$("#yanzhengma").val()}),function(data){
						   if(data.code<0){
						    $("#noXError").css("display","block");
					    	  $("#setH2").html(data.msg);
						   }else{
						         $.ajax({
							  url:"@{front.webAccount.AccountHome.saveWebEmails()}",
							  type:"POST",
							  data:{
							  email:email
							  },
							  success:function(data){
							      if(data.code<0){
							       $("#noXError").css("display","block");
					    	       $("#setH2").html(data.msg);
							      }else{
							       location.reload();
							      }
							  }
							 });
				        }
			  		});
			 })
			 
			 var remain = 60;
		
		function countDown1() {
		  if (remain == 0) {
		    remain = 60;
		    $("#codeTimes1").html("点击发送");
		    $("#codeTimes1").attr("onclick", "sendCode1();");
		    return;
		  }
		  $("#codeTimes1").html("" + remain-- + "秒后重发");
		  setTimeout("countDown1()",1000);
		}
			function sendCode1(){
			var mobile = $("#mobile").val();
		     var verifyWebMobile = #{jsAction @verifyWebMobile(':mobile')/}
			$.post(verifyWebMobile({mobile:mobile}),function(data){
			    if(data.error.code < 0){
			      $("#noXError").css("display","block");
					$("#setH2").html(data.error.msg);
			    }else{
					countDown1();
					$("#codeTimes1").attr("onclick", "void(0);");
				}
			},'json');
		    }
			 $("#setMobile").click(function(){
			 $("#mobile").removeAttr("readonly");
			     $("#code1").css("display","block");
			             var mobile = $("#mobile").val();
			              if(mobile == ''){
							$("#noXError").css("display","block");
			                 $("#setH2").html("请输入手机号");
							return false;
						 } 
			              if($("#yanzhengma1").val() == ''){
							$("#noXError").css("display","block");
			                 $("#setH2").html("请输入验证码");
							return false;
						 } 
					/* 
					验证验证码
					*/
					var verifySmsCodeWeb = #{jsAction @verifySmsCodeWeb(':mobile',':smsCode')/}
				  		$.post(verifySmsCodeWeb({mobile:mobile,smsCode:$("#yanzhengma1").val()}),function(data){
						   if(data.code<0){
						   $("#noXError").css("display","block");
			                 $("#setH2").html(data.msg);
						   }else{
							      $.ajax({
								  url:"@{front.webAccount.AccountHome.saveWebPhones()}",
								  type:"POST",
								  data:{
								  mobile:mobile
								  },
								  success:function(data){
								      if(data.code<0){
								       $("#noXError").css("display","block");
						    	       $("#setH2").html(data.msg);
								      }else{
								       location.reload();
								      }
								  }
								 });
				  			 }
			  		});
			 })
			 
			  var remain = 60;
		
		function countDowns() {
		  if (remain == 0) {
		    remain = 60;
		    $("#codeTimess").html("点击发送");
		    $("#codeTimess").attr("onclick", "sendCodes();");
		    return;
		  }
		  $("#codeTimess").html("" + remain-- + "秒后重发");
		  setTimeout("countDowns()",1000);
		}
			function sendCodes(){
			var mobile = "${users?.mobile}";
		     var verifyWebPassword = #{jsAction @verifyWebPassword(':mobile')/}
			$.post(verifyWebPassword({mobile:mobile}),function(data){
			    if(data.error.code < 0){
			      $("#noXError").css("display","block");
					$("#setH2").html(data.error.msg);
			    }else{
					countDowns();
					$("#codeTimess").attr("onclick", "void(0);");
				}
			},'json');
		    }
			 $("#submitPassword").click(function(){
			            var originalPassword=$("#originalPassword").val();
			            var mobileCode=$("#mobileCode").val();
			            var password=$("#password").val();
			            var confirmPassword=$("#confirmPassword").val();
			             if (originalPassword == "") {
						   $("#error").html("请输入原密码");
							return false;
				      	}
				      	if (mobileCode == "") {
						   $("#error").html("请输入验证码");
							return false;
				      	}
			            if (password == "") {
					   $("#error").html("请设置密码");
						return false;
					}else if (password.length < 6){
						$("#error").html("密码长度为6-16个字符");
						return false;
					}else if (password.length >16){
						$("#error").html("密码长度为6-16个字符");
						return false;
					}else if (!/^([^\s'‘’]{6,20})$/.test(password)){
						$("#error").html("密码由6-16位字符组成(不含')");
						return false;
					}
					if(confirmPassword == ""){
						$("#error").html("请输入密码确认");
					      return false;
					 }else if(confirmPassword != $("#password").val()){
						 $("#error").html("两次输入的密码不一致");
					      return false;
					 }
					 /* 
					验证验证码
					*/
					var verifySmsCodePassword = #{jsAction @verifySmsCodePassword(':mobile',':smsCode')/}
				  		$.post(verifySmsCodePassword({mobile:${users?.mobile},smsCode:mobileCode}),function(data){
						   if(data.code<0){
						   $("#noXError").css("display","block");
			                 $("#setH2").html(data.msg);
						   }else{
							    $("#form").submit();
				  			 }
			  		});
			 })
			 $("#sure").click(function(){
  		     $("#noXError").css("display","none");
  		      })
  		$("#buyVipCancel").click(function(){
  		     $("#noXError").css("display","none");
  		})
  		$("#loginPass").click(function(){
  		 location.href="@{front.webHome.HomeAction.home}?sign=loginPass";
  		})
			</script>
	</body>

</html>