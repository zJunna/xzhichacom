<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title>找回密码</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
		<meta name="format-detection" content="telephone=no" />
		<link rel="shortcut icon" type="image/png" href="@{'/public/images/favicon.ico'}" />
		<link rel="stylesheet" type="text/css" href="/public/stylesheets/css/reset.css" />
		<link rel="stylesheet" type="text/css" href="/public/stylesheets/css/style.css" />
		<script type="text/javascript" src="/public/javascripts/js/jquery.1.9.1.js"></script>
		<script type="text/javascript" src="/public/javascripts/js/js.js"></script>
	</head>

	<body class="ggg">
		<div class="pay_tits fff">
			<img src="/public/images/img/land_icon_03.png"  onclick="javascript:history.back(-1);"/>
			<p>找回密码</p>
		</div>
		<form action="@{front.account.RegisterAndLogin.passwordSetAgain()}" method="post" id="form">
		<div class="reg">
			<div class="reg_lable">
				<input type="text" placeholder="请输入手机号" name="mobile" id="mobile" value="" />
			</div>
			<div class="reg_lable">
				<input type="text" placeholder="请输入验证码" id="yanzhengma" name="yanzhengma"value="" />
				<a href="#" class="hqs"  id="codeTimes"  onclick="sendCode();">获取验证码</a>
			</div>
			<span id="errorInfo" style="color: #f85d7a; font-size:.26rem;position: absolute;top: 67%;left: 9%;">${flash?.error}</span>
			<div class="buttonser">
				<a id="submit">下一步</a>
			</div>
		</div>
		</form>
		<script>
			$('.reg_lable input').bind('input propertychange', function() {
				if($(this).val() != '') {
					$('.buttonser').addClass('on');
				} else {
					$('.buttonser').removeClass('on');
				}
			});
			/* var min = 60;
			$('.hqs').click(function() {
				if($(this).hasClass('on')) {} else {
					$(this).addClass('on');
					$(this).html('再次获取(' + min + ')')
					var timer = setInterval(function() {
						min--;
						$('.hqs').html('再次获取(' + min + ')')
						if(min == 0) {
							clearInterval(timer);
							min = 60;
							$('.hqs').removeClass('on');
							$('.hqs').html('重新获取')
						}
					}, 1000);
				}
			}) */
			var remain = 60;
		
		function countDown() {
		  if (remain == 0) {
		    remain = 60;
		    $("#codeTimes").html("点击发送");
		    $("#codeTimes").attr("onclick", "sendCode();");
		    return;
		  }
		  $("#codeTimes").html("" + remain-- + "秒后重发");
		  setTimeout("countDown()",1000);
		}
			function sendCode(){
			
			var mobile = $("#mobile").val();
			if($("#mobile").val() == ''){
				$("#errorInfo").html("请输入手机号"); 
				return false;
			 } 
			 if($("#mobile").val()!=""){
			    if(!(/^1[34578]\d{9}$/.test($("#mobile").val()))){
				     $("#errorInfo").html("手机号码格式有误，请重新输入"); 
				        return false; 
				    }
	    	}
			$.ajax({
	    		url:"@{front.account.RegisterAndLogin.isMobileReg()}",
	    		type:"POST",
	    		data:{
	    		mobile:$("#mobile").val()
	    		},
	    		success:function(data){
	    			if(data.code==-1){
	    				$("#errorInfo").html("未检测到账号,请注册"); 
	    				return false; 
	    			}else{
	    				$("#errorInfo").html("");
				     var verifyMobile1 = #{jsAction @verifyMobile1(':mobile')/}
					$.post(verifyMobile1({mobile:mobile}),function(data){
					    if(data.error.code < 0){
						    $("#errorInfo").html(data.error.msg);
					    }else{
					    	$("#errorInfo").html("");
							countDown();
							$("#codeTimes").attr("onclick", "void(0);");
						}
					},'json');
			    			}
	    		}
	    	});
		    }
		    
	$(".buttonser").click(function(){
	
			 if($("#mobile").val() == ''){
				$("#errorInfo").html("请输入手机号"); 
				return false;
			 } 
			if($("#mobile").val()!=""){
			    if(!(/^1[34578]\d{9}$/.test($("#mobile").val()))){
				     $("#errorInfo").html("手机号码格式有误，请重新输入"); 
				        return false; 
				    }
	    	}
		    if($("#yanzhengma").val() == ''){
				$("#errorInfo").html("请输入验证码"); 
				return false;
			 } 
		/* /* 
		验证验证码
		*/
		var verifySmsCodeFor = #{jsAction @verifySmsCodeFor(':mobile',':smsCode')/}
	  		$.post(verifySmsCodeFor({mobile:$("#mobile").val(),smsCode:$("#yanzhengma").val()}),function(data){
			   if(data.code<0){
		    	  $("#errorInfo").html(data.msg);
		    	  return false;
			   }else{
			   $("#errorInfo").html("");
			   $("#form").submit();
	  			 }
  		});
  		
  	});	
		</script>
	</body>

</html>